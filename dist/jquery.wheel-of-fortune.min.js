/**
 * @license jq-wheel-of-fortune v1.0.0
 * (c) 2018 Finsi, Inc.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.jqWheelOfFortune={})}(this,function(t){"use strict";var e;(e=t.WheelOfFortuneEvents||(t.WheelOfFortuneEvents={})).onWheelSpin="wof:spin",e.onWheelSpinEnd="wof:spin-end",e.onQuestion="wof:question",e.onAnswer="wof:answer",e.onEnd="wof:end";var s=function(){return function(){}}(),n=function(){return function(){}}(),o=function(){return function(){}}(),a=function(){return function(){}}(),r=function(){return function(){}}();function h(t,e){for(var i in defaultOptions={canvasId:"canvas",centerX:null,centerY:null,outerRadius:null,innerRadius:0,numSegments:1,drawMode:"code",rotationAngle:0,textFontFamily:"Arial",textFontSize:20,textFontWeight:"bold",textOrientation:"horizontal",textAlignment:"center",textDirection:"normal",textMargin:null,textFillStyle:"black",textStrokeStyle:null,textLineWidth:1,fillStyle:"silver",strokeStyle:"black",lineWidth:1,clearTheCanvas:!0,imageOverlay:!1,drawText:!0,pointerAngle:0,wheelImage:null,imageDirection:"N"},defaultOptions)null!=t&&void 0!==t[i]?this[i]=t[i]:this[i]=defaultOptions[i];if(null!=t)for(var i in t)void 0===this[i]&&(this[i]=t[i]);for(this.canvasId?(this.canvas=document.getElementById(this.canvasId),this.canvas?(null==this.centerX&&(this.centerX=this.canvas.width/2),null==this.centerY&&(this.centerY=this.canvas.height/2),null==this.outerRadius&&(this.canvas.width<this.canvas.height?this.outerRadius=this.canvas.width/2-this.lineWidth:this.outerRadius=this.canvas.height/2-this.lineWidth),this.ctx=this.canvas.getContext("2d")):(this.canvas=null,this.ctx=null)):(this.cavnas=null,this.ctx=null),this.segments=new Array(null),x=1;x<=this.numSegments;x++)null!=t&&t.segments&&void 0!==t.segments[x-1]?this.segments[x]=new c(t.segments[x-1]):this.segments[x]=new c;if(this.updateSegmentSizes(),null===this.textMargin&&(this.textMargin=this.textFontSize/1.7),null!=t&&t.animation&&void 0!==t.animation?this.animation=new l(t.animation):this.animation=new l,null!=t&&t.pins&&void 0!==t.pins&&(this.pins=new function(t){for(var e in defaultOptions={visible:!0,number:36,outerRadius:3,fillStyle:"grey",strokeStyle:"black",lineWidth:1,margin:3},defaultOptions)null!=t&&void 0!==t[e]?this[e]=t[e]:this[e]=defaultOptions[e];if(null!=t)for(var e in t)void 0===this[e]&&(this[e]=t[e])}(t.pins)),"image"==this.drawMode||"segmentImage"==this.drawMode?(void 0===t.fillStyle&&(this.fillStyle=null),void 0===t.strokeStyle&&(this.strokeStyle="red"),void 0===t.drawText&&(this.drawText=!1),void 0===t.lineWidth&&(this.lineWidth=1),void 0===e&&(e=!1)):void 0===e&&(e=!0),null!=t&&t.pointerGuide&&void 0!==t.pointerGuide?this.pointerGuide=new u(t.pointerGuide):this.pointerGuide=new u,1==e)this.draw(this.clearTheCanvas);else if("segmentImage"==this.drawMode)for(d=this,p=!1,y=1;y<=this.numSegments;y++)null!==this.segments[y].image&&(this.segments[y].imgData=new Image,this.segments[y].imgData.onload=f,this.segments[y].imgData.src=this.segments[y].image)}function l(t){for(var e in defaultOptions={type:"spinOngoing",direction:"clockwise",propertyName:null,propertyValue:null,duration:10,yoyo:!1,repeat:0,easing:"power3.easeOut",stopAngle:null,spins:null,clearTheCanvas:null,callbackFinished:null,callbackBefore:null,callbackAfter:null},defaultOptions)null!=t&&void 0!==t[e]?this[e]=t[e]:this[e]=defaultOptions[e];if(null!=t)for(var e in t)void 0===this[e]&&(this[e]=t[e])}function c(t){for(var e in defaultOptions={size:null,text:"",fillStyle:null,strokeStyle:null,lineWidth:null,textFontFamily:null,textFontSize:null,textFontWeight:null,textOrientation:null,textAlignment:null,textDirection:null,textMargin:null,textFillStyle:null,textStrokeStyle:null,textLineWidth:null,image:null,imageDirection:null,imgData:null},defaultOptions)null!=t&&void 0!==t[e]?this[e]=t[e]:this[e]=defaultOptions[e];if(null!=t)for(var e in t)void 0===this[e]&&(this[e]=t[e]);this.startAngle=0,this.endAngle=0}function u(t){for(var e in defaultOptions={display:!1,strokeStyle:"red",lineWidth:3},defaultOptions)null!=t&&void 0!==t[e]?this[e]=t[e]:this[e]=defaultOptions[e]}function g(){d&&(0!=d.animation.clearTheCanvas&&d.ctx.clearRect(0,0,d.canvas.width,d.canvas.height),null!=d.animation.callbackBefore&&"function"==(typeof d.animation.callbackBefore).toLowerCase()&&d.animation.callbackBefore(),d.draw(!1),null!=d.animation.callbackAfter&&"function"==(typeof d.animation.callbackAfter).toLowerCase()&&d.animation.callbackAfter())}h.prototype.updateSegmentSizes=function(){if(this.segments){var t=0,e=0;for(x=1;x<=this.numSegments;x++)null!==this.segments[x].size&&(t+=this.segments[x].size,e++);var i=360-t,s=0;i>0&&(s=i/(this.numSegments-e));var n=0;for(x=1;x<=this.numSegments;x++)this.segments[x].startAngle=n,this.segments[x].size?n+=this.segments[x].size:n+=s,this.segments[x].endAngle=n}},h.prototype.clearCanvas=function(){this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},h.prototype.draw=function(t){this.ctx&&(void 0!==t?1==t&&this.clearCanvas():this.clearCanvas(),"image"==this.drawMode?(this.drawWheelImage(),1==this.drawText&&this.drawSegmentText(),1==this.imageOverlay&&this.drawSegments()):"segmentImage"==this.drawMode?(this.drawSegmentImages(),1==this.drawText&&this.drawSegmentText(),1==this.imageOverlay&&this.drawSegments()):(this.drawSegments(),1==this.drawText&&this.drawSegmentText()),void 0!==this.pins&&1==this.pins.visible&&this.drawPins(),1==this.pointerGuide.display&&this.drawPointerGuide())},h.prototype.drawPins=function(){if(this.pins&&this.pins.number){var t=360/this.pins.number;for(i=1;i<=this.pins.number;i++)this.ctx.save(),this.ctx.strokeStyle=this.pins.strokeStyle,this.ctx.lineWidth=this.pins.lineWidth,this.ctx.fillStyle=this.pins.fillStyle,this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(i*t+this.rotationAngle)),this.ctx.translate(-this.centerX,-this.centerY),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY-this.outerRadius+this.pins.outerRadius+this.pins.margin,this.pins.outerRadius,0,2*Math.PI),this.pins.fillStyle&&this.ctx.fill(),this.pins.strokeStyle&&this.ctx.stroke(),this.ctx.restore()}},h.prototype.drawPointerGuide=function(){this.ctx&&(this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(this.pointerAngle)),this.ctx.translate(-this.centerX,-this.centerY),this.ctx.strokeStyle=this.pointerGuide.strokeStyle,this.ctx.lineWidth=this.pointerGuide.lineWidth,this.ctx.beginPath(),this.ctx.moveTo(this.centerX,this.centerY),this.ctx.lineTo(this.centerX,-this.outerRadius/4),this.ctx.stroke(),this.ctx.restore())},h.prototype.drawWheelImage=function(){if(null!=this.wheelImage){var t=this.centerX-this.wheelImage.height/2,e=this.centerY-this.wheelImage.width/2;this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(this.rotationAngle)),this.ctx.translate(-this.centerX,-this.centerY),this.ctx.drawImage(this.wheelImage,t,e),this.ctx.restore()}},h.prototype.drawSegmentImages=function(){if(this.ctx&&this.segments)for(x=1;x<=this.numSegments;x++)if(seg=this.segments[x],seg.imgData.height){var t=0,e=0,i=0,s="";"S"==(s=null!==seg.imageDirection?seg.imageDirection:this.imageDirection)?(t=this.centerX-seg.imgData.width/2,e=this.centerY,i=seg.startAngle+180+(seg.endAngle-seg.startAngle)/2):"E"==s?(t=this.centerX,e=this.centerY-seg.imgData.height/2,i=seg.startAngle+270+(seg.endAngle-seg.startAngle)/2):"W"==s?(t=this.centerX-seg.imgData.width,e=this.centerY-seg.imgData.height/2,i=seg.startAngle+90+(seg.endAngle-seg.startAngle)/2):(t=this.centerX-seg.imgData.width/2,e=this.centerY-seg.imgData.height,i=seg.startAngle+(seg.endAngle-seg.startAngle)/2),this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(this.rotationAngle+i)),this.ctx.translate(-this.centerX,-this.centerY),this.ctx.drawImage(seg.imgData,t,e),this.ctx.restore()}else console.log("Segment "+x+" imgData is not loaded")},h.prototype.drawSegments=function(){if(this.ctx&&this.segments)for(x=1;x<=this.numSegments;x++){var t,e,i;seg=this.segments[x],t=null!==seg.fillStyle?seg.fillStyle:this.fillStyle,this.ctx.fillStyle=t,e=null!==seg.lineWidth?seg.lineWidth:this.lineWidth,this.ctx.lineWidth=e,i=null!==seg.strokeStyle?seg.strokeStyle:this.strokeStyle,this.ctx.strokeStyle=i,(i||t)&&(this.ctx.beginPath(),this.innerRadius||this.ctx.moveTo(this.centerX,this.centerY),this.ctx.arc(this.centerX,this.centerY,this.outerRadius,this.degToRad(seg.startAngle+this.rotationAngle-90),this.degToRad(seg.endAngle+this.rotationAngle-90),!1),this.innerRadius?this.ctx.arc(this.centerX,this.centerY,this.innerRadius,this.degToRad(seg.endAngle+this.rotationAngle-90),this.degToRad(seg.startAngle+this.rotationAngle-90),!0):this.ctx.lineTo(this.centerX,this.centerY),t&&this.ctx.fill(),i&&this.ctx.stroke())}},h.prototype.drawSegmentText=function(){var t,e,s,n,o,a,r,h,l,c,u;if(this.ctx)for(x=1;x<=this.numSegments;x++){if(this.ctx.save(),seg=this.segments[x],seg.text){t=null!==seg.textFontFamily?seg.textFontFamily:this.textFontFamily,e=null!==seg.textFontSize?seg.textFontSize:this.textFontSize,s=null!==seg.textFontWeight?seg.textFontWeight:this.textFontWeight,n=null!==seg.textOrientation?seg.textOrientation:this.textOrientation,o=null!==seg.textAlignment?seg.textAlignment:this.textAlignment,a=null!==seg.textDirection?seg.textDirection:this.textDirection,r=null!==seg.textMargin?seg.textMargin:this.textMargin,h=null!==seg.textFillStyle?seg.textFillStyle:this.textFillStyle,l=null!==seg.textStrokeStyle?seg.textStrokeStyle:this.textStrokeStyle,c=null!==seg.textLineWidth?seg.textLineWidth:this.textLineWidth,u="",null!=s&&(u+=s+" "),null!=e&&(u+=e+"px "),null!=t&&(u+=t),this.ctx.font=u,this.ctx.fillStyle=h,this.ctx.strokeStyle=l,this.ctx.lineWidth=c;var g=seg.text.split("\n"),d=0-e*(g.length/2)+e/2;for("curved"!=n||"inner"!=o&&"outer"!=o||(d=0),i=0;i<g.length;i++){if("reversed"==a){if("horizontal"==n){this.ctx.textAlign="inner"==o?"right":"outer"==o?"left":"center",this.ctx.textBaseline="middle";var m=this.degToRad(seg.endAngle-(seg.endAngle-seg.startAngle)/2+this.rotationAngle-90-180);this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(m),this.ctx.translate(-this.centerX,-this.centerY),"inner"==o?(h&&this.ctx.fillText(g[i],this.centerX-this.innerRadius-r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX-this.innerRadius-r,this.centerY+d)):"outer"==o?(h&&this.ctx.fillText(g[i],this.centerX-this.outerRadius+r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX-this.outerRadius+r,this.centerY+d)):(h&&this.ctx.fillText(g[i],this.centerX-this.innerRadius-(this.outerRadius-this.innerRadius)/2-r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX-this.innerRadius-(this.outerRadius-this.innerRadius)/2-r,this.centerY+d)),this.ctx.restore()}else if("vertical"==n){this.ctx.textAlign="center",this.ctx.textBaseline="inner"==o?"top":"outer"==o?"bottom":"middle";m=seg.endAngle-(seg.endAngle-seg.startAngle)/2-180;if(m+=this.rotationAngle,this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(m)),this.ctx.translate(-this.centerX,-this.centerY),"outer"==o)var p=this.centerY+this.outerRadius-r;else if("inner"==o)p=this.centerY+this.innerRadius+r;var f=e-e/9;if("outer"==o)for(var y=g[i].length-1;y>=0;y--)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p-=f;else if("inner"==o)for(y=0;y<g[i].length;y++)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p+=f;else if("center"==o){var v=0;g[i].length>1&&(v=f*(g[i].length-1)/2);for(p=this.centerY+this.innerRadius+(this.outerRadius-this.innerRadius)/2+v+r,y=g[i].length-1;y>=0;y--)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p-=f}this.ctx.restore()}else if("curved"==n){var w=0;"inner"==o?(w=this.innerRadius+r,this.ctx.textBaseline="top"):"outer"==o?(w=this.outerRadius-r,this.ctx.textBaseline="bottom",w-=e*(g.length-1)):"center"==o&&(w=this.innerRadius+r+(this.outerRadius-this.innerRadius)/2,this.ctx.textBaseline="middle");var A=0,S=0;for(g[i].length>1?(this.ctx.textAlign="left",A=e/10*4,radiusPercent=100/w,A*=radiusPercent,totalArc=A*g[i].length,S=seg.startAngle+((seg.endAngle-seg.startAngle)/2-totalArc/2)):(S=seg.startAngle+(seg.endAngle-seg.startAngle)/2,this.ctx.textAlign="center"),S+=this.rotationAngle,S-=180,y=g[i].length;y>=0;y--)this.ctx.save(),character=g[i].charAt(y),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(S)),this.ctx.translate(-this.centerX,-this.centerY),l&&this.ctx.strokeText(character,this.centerX,this.centerY+w+d),h&&this.ctx.fillText(character,this.centerX,this.centerY+w+d),S+=A,this.ctx.restore()}}else if("horizontal"==n){this.ctx.textAlign="inner"==o?"left":"outer"==o?"right":"center",this.ctx.textBaseline="middle";m=this.degToRad(seg.endAngle-(seg.endAngle-seg.startAngle)/2+this.rotationAngle-90);this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(m),this.ctx.translate(-this.centerX,-this.centerY),"inner"==o?(h&&this.ctx.fillText(g[i],this.centerX+this.innerRadius+r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX+this.innerRadius+r,this.centerY+d)):"outer"==o?(h&&this.ctx.fillText(g[i],this.centerX+this.outerRadius-r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX+this.outerRadius-r,this.centerY+d)):(h&&this.ctx.fillText(g[i],this.centerX+this.innerRadius+(this.outerRadius-this.innerRadius)/2+r,this.centerY+d),l&&this.ctx.strokeText(g[i],this.centerX+this.innerRadius+(this.outerRadius-this.innerRadius)/2+r,this.centerY+d)),this.ctx.restore()}else if("vertical"==n){this.ctx.textAlign="center",this.ctx.textBaseline="inner"==o?"bottom":"outer"==o?"top":"middle";m=seg.endAngle-(seg.endAngle-seg.startAngle)/2;if(m+=this.rotationAngle,this.ctx.save(),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(m)),this.ctx.translate(-this.centerX,-this.centerY),"outer"==o)p=this.centerY-this.outerRadius+r;else if("inner"==o)p=this.centerY-this.innerRadius-r;f=e-e/9;if("outer"==o)for(y=0;y<g[i].length;y++)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p+=f;else if("inner"==o)for(y=g[i].length-1;y>=0;y--)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p-=f;else if("center"==o){v=0;g[i].length>1&&(v=f*(g[i].length-1)/2);for(p=this.centerY-this.innerRadius-(this.outerRadius-this.innerRadius)/2-v-r,y=0;y<g[i].length;y++)character=g[i].charAt(y),h&&this.ctx.fillText(character,this.centerX+d,p),l&&this.ctx.strokeText(character,this.centerX+d,p),p+=f}this.ctx.restore()}else if("curved"==n){w=0;"inner"==o?(w=this.innerRadius+r,this.ctx.textBaseline="bottom",w+=e*(g.length-1)):"outer"==o?(w=this.outerRadius-r,this.ctx.textBaseline="top"):"center"==o&&(w=this.innerRadius+r+(this.outerRadius-this.innerRadius)/2,this.ctx.textBaseline="middle");A=0,S=0;for(g[i].length>1?(this.ctx.textAlign="left",A=e/10*4,radiusPercent=100/w,A*=radiusPercent,totalArc=A*g[i].length,S=seg.startAngle+((seg.endAngle-seg.startAngle)/2-totalArc/2)):(S=seg.startAngle+(seg.endAngle-seg.startAngle)/2,this.ctx.textAlign="center"),S+=this.rotationAngle,y=0;y<g[i].length;y++)this.ctx.save(),character=g[i].charAt(y),this.ctx.translate(this.centerX,this.centerY),this.ctx.rotate(this.degToRad(S)),this.ctx.translate(-this.centerX,-this.centerY),l&&this.ctx.strokeText(character,this.centerX,this.centerY-w+d),h&&this.ctx.fillText(character,this.centerX,this.centerY-w+d),S+=A,this.ctx.restore()}d+=e}}this.ctx.restore()}},h.prototype.degToRad=function(t){return.017453292519943295*t},h.prototype.setCenter=function(t,e){this.centerX=t,this.centerY=e},h.prototype.addSegment=function(t,e){var i;if(newSegment=new c(t),this.numSegments++,void 0!==e){for(var s=this.numSegments;s>e;s--)this.segments[s]=this.segments[s-1];this.segments[e]=newSegment,i=e}else this.segments[this.numSegments]=newSegment,i=this.numSegments;return this.updateSegmentSizes(),this.segments[i]},h.prototype.setCanvasId=function(t){t?(this.canvasId=t,this.canvas=document.getElementById(this.canvasId),this.canvas&&(this.ctx=this.canvas.getContext("2d"))):(this.canvasId=null,this.ctx=null,this.canvas=null)},h.prototype.deleteSegment=function(t){if(this.numSegments>1){if(void 0!==t)for(var e=t;e<this.numSegments;e++)this.segments[e]=this.segments[e+1];this.segments[this.numSegments]=void 0,this.numSegments--,this.updateSegmentSizes()}},h.prototype.windowToCanvas=function(t,e){var i=this.canvas.getBoundingClientRect();return{x:Math.floor(t-i.left*(this.canvas.width/i.width)),y:Math.floor(e-i.top*(this.canvas.height/i.height))}},h.prototype.getSegmentAt=function(t,e){var i=null,s=this.getSegmentNumberAt(t,e);return null!==s&&(i=this.segments[s]),i},h.prototype.getSegmentNumberAt=function(t,e){var i,s,n,o,a,r=this.windowToCanvas(t,e);r.x>this.centerX?(n=r.x-this.centerX,s="R"):(n=this.centerX-r.x,s="L"),r.y>this.centerY?(o=r.y-this.centerY,i="B"):(o=this.centerY-r.y,i="T");var h=o/n,l=180*Math.atan(h)/Math.PI,c=0;(a=Math.sqrt(o*o+n*n),"T"==i&&"R"==s?c=Math.round(90-l):"B"==i&&"R"==s?c=Math.round(l+90):"B"==i&&"L"==s?c=Math.round(90-l+180):"T"==i&&"L"==s&&(c=Math.round(l+270)),0!=this.rotationAngle)&&((c-=this.getRotationPosition())<0&&(c=360-Math.abs(c)));var u=null;for(t=1;t<=this.numSegments;t++)if(c>=this.segments[t].startAngle&&c<=this.segments[t].endAngle&&a>=this.innerRadius&&a<=this.outerRadius){u=t;break}return u},h.prototype.getIndicatedSegment=function(){var t=this.getIndicatedSegmentNumber();return this.segments[t]},h.prototype.getIndicatedSegmentNumber=function(){var t=0,e=this.getRotationPosition(),i=Math.floor(this.pointerAngle-e);for(i<0&&(i=360-Math.abs(i)),x=1;x<this.segments.length;x++)if(i>=this.segments[x].startAngle&&i<=this.segments[x].endAngle){t=x;break}return t},h.prototype.getRotationPosition=function(){var t=this.rotationAngle;if(t>=0){if(t>360)t-=360*Math.floor(t/360)}else{if(t<-360)t-=360*Math.ceil(t/360);t=360+t}return t},h.prototype.startAnimation=function(){if(this.animation){this.computeAnimation(),d=this;var t=new Array(null);t[this.animation.propertyName]=this.animation.propertyValue,t.yoyo=this.animation.yoyo,t.repeat=this.animation.repeat,t.ease=this.animation.easing,t.onUpdate=g,t.onComplete=m,this.tween=TweenMax.to(this,this.animation.duration,t)}},h.prototype.stopAnimation=function(t){d&&(d.tween.kill(),m(t)),d=this},h.prototype.pauseAnimation=function(){this.tween&&this.tween.pause()},h.prototype.resumeAnimation=function(){this.tween&&this.tween.play()},h.prototype.computeAnimation=function(){this.animation&&("spinOngoing"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=-1),null==this.animation.easing&&(this.animation.easing="Linear.easeNone"),null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction&&(this.animation.propertyValue=0-this.animation.propertyValue)):"spinToStop"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=0),null==this.animation.easing&&(this.animation.easing="Power4.easeOut"),null==this.animation.stopAngle?this.animation._stopAngle=Math.floor(359*Math.random()):this.animation._stopAngle=360-this.animation.stopAngle+this.pointerAngle,null==this.animation.yoyo&&(this.animation.yoyo=!1),this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle):"spinAndBack"==this.animation.type?(this.animation.propertyName="rotationAngle",null==this.animation.spins&&(this.animation.spins=5),null==this.animation.repeat&&(this.animation.repeat=1),null==this.animation.easing&&(this.animation.easing="Power2.easeInOut"),null==this.animation.yoyo&&(this.animation.yoyo=!0),null==this.animation.stopAngle?this.animation._stopAngle=0:this.animation._stopAngle=360-this.animation.stopAngle,this.animation.propertyValue=360*this.animation.spins,"anti-clockwise"==this.animation.direction?(this.animation.propertyValue=0-this.animation.propertyValue,this.animation.propertyValue-=360-this.animation._stopAngle):this.animation.propertyValue+=this.animation._stopAngle):this.animation.type)},h.prototype.getRandomForSegment=function(t){var e=0;if(t)if(void 0!==this.segments[t]){var i=this.segments[t].startAngle,s=this.segments[t].endAngle-i-2;s>0?e=i+1+Math.floor(Math.random()*s):console.log("Segment size is too small to safely get random angle inside it")}else console.log("Segment "+t+" undefined");else console.log("Segment number not specified");return e},c.prototype.changeImage=function(t,e){this.image=t,this.imgData=null,e&&(this.imageDirection=e),p=!1,this.imgData=new Image,this.imgData.onload=f,this.imgData.src=this.image};var d=null;function m(t){0!=t&&null!=d.animation.callbackFinished&&"function"==(typeof d.animation.callbackFinished).toLowerCase()&&d.animation.callbackFinished()}var p=!1;function f(){if(0==p){var t=0;for(i=1;i<=d.numSegments;i++)null!=d.segments[i].imgData&&d.segments[i].imgData.height&&t++;t==d.numSegments&&(p=!0,d.draw())}}module.exports=h;var v=Object.freeze({}),w=function(){function e(){}return e.prototype._create=function(){this.element.addClass(this.options.classes.root),this._getElements(),this.$objectivesBar.progressbar(),this._initDialog(),this._disableDialog(),this._createWheel(),this._initWheel(),this._assignEvents()},e.prototype._getCreateOptions=function(){return{namespace:"jq-wheeloffortune",rounds:-1,pointsForSuccess:1,pointsForFail:0,cutOfMarkPoints:0,lives:-1,autoCloseQuestionDialogIn:3e3,classes:{root:"wof",answers:"wof__answers",answer:"wof__answers__answer",answerCorrect:"wof--correct",answerIncorrect:"wof--incorrect",running:"wof--running",success:"wof--success",fail:"wof--fail",live:"wof__lives__live",lives:"wof__lives",lostLive:"wof__lives__live--lost",historicCategory:"wof__historic__category",historicCategoryTitle:"wof__historic__category__title",historicAnswersContainer:"wof__historic__category__answers",historicItem:"wof__historic__category__answer",historicItemSuccess:"wof__historic__category__answer--success",historicItemFail:"wof__historic__category__answer--fail",question:"wof__question"},catalog:[],dialog:{classes:{"ui-dialog":"wof-dialog"},draggable:!1,resizable:!1,position:{my:"center",at:"center"},closeOnEscape:!1,show:{effect:"blind",duration:400},hide:{effect:"blind",duration:400}},selectors:{queryWheel:"[data-wof-wheel]",querySpin:"[data-wof-spin]",queryScore:"[data-wof-score]",queryObjectiveBar:"[data-wof-objective-bar]",queryLives:"[data-wof-lives]",queryHistoric:"[data-wof-historic]",queryQuestionsDialog:"[data-wof-dialog]",queryQuestionsDialogQuestion:"[data-wof-question]",queryQuestionsDialogAnswers:"[data-wof-answers]",queryCheckAnswer:"[data-wof-check-answer]"},wheel:{textSize:14,numSegments:6,animation:{duration:3,spins:6}}}},e.prototype._getElements=function(){this.$wheel=this.element.find(this.options.selectors.queryWheel),this.$spin=this.element.find(this.options.selectors.querySpin),this.$score=this.element.find(this.options.selectors.queryScore),this.$objectivesBar=this.element.find(this.options.selectors.queryObjectiveBar),this.$lives=this.element.find(this.options.selectors.queryLives),this.$historic=this.element.find(this.options.selectors.queryHistoric),this.$dialog=this.element.find(this.options.selectors.queryQuestionsDialog),this.$dialogQuestion=this.$dialog.find(this.options.selectors.queryQuestionsDialogQuestion),this.$dialogQuestion.addClass(this.options.classes.question),this.$dialogAnswers=this.$dialog.find(this.options.selectors.queryQuestionsDialogAnswers),this.$checkAnswer=this.$dialog.find(this.options.selectors.queryCheckAnswer)},e.prototype._initDialog=function(){var t=$.extend(!0,{},this.options.dialog);t.autoOpen=!1,t.position&&void 0==t.position.of&&(t.position.of=this.element),this.$dialog.dialog(t)},e.prototype._disableDialog=function(){this.$dialog.dialog("disable")},e.prototype._enableDialog=function(){this.$dialog.dialog("enable")},e.prototype._createWheel=function(){this.$wheel.uniqueId()},e.prototype._updateCanvasDimensions=function(){this.$wheel.get(0).height=parseFloat(this.$wheel.css("height")),this.$wheel.get(0).width=parseFloat(this.$wheel.css("width")),this.winWheelInstance.draw()},e.prototype._createHistoric=function(){var t={};if(this.$historic.length>0){var e=this.runtime.catalog;this.$historic.empty();for(var i=0,s=e;i<s.length;i++){var n=s[i],o=$('<div class="'+this.options.classes.historicCategory+'" data-wof-historic-item="'+n.id+'"><p class="'+this.options.classes.historicCategoryTitle+'">'+n.title+"</p></div>"),a=$('<div class="'+this.options.classes.historicAnswersContainer+'"></div>');t[n.id]={$container:o,$registryContainer:a},o.append(a),this.$historic.append(o)}}return t},e.prototype._createLives=function(){var t=this.options.lives,e="";if(-1!=t)for(;t>0;t--)e+='<i class="'+this.options.classes.live+'"></i>';this.$lives.empty().append(e)},e.prototype._resetWheel=function(){var t=this.runtime.catalog;this.winWheelInstance.segments=[],this.winWheelInstance.numSegments=0;for(var e=0,i=t;e<i.length;e++){var s=i[e];this.winWheelInstance.addSegment($.extend({text:s.title,fillStyle:s.color,categoryId:s.id,textFillStyle:s.titleColor},s.wheel||{}),1)}this.winWheelInstance.draw()},e.prototype._initWheel=function(){var t=$.extend(!0,this.options.wheel,{canvasId:this.$wheel.attr("id"),animation:{type:"spinToStop",callbackFinished:this._onSpinWheelEnd.bind(this),yoyo:!0}});this.winWheelInstance=new v(t)},e.prototype._assignEvents=function(){this.$spin.on("click",{instance:this},this._onSpinBtnClick),this.$checkAnswer.on("click",{instance:this},this._onCheckAnswersBtnClick),this.$dialog.on("dialogclose",{instance:this},this._onQuestionDialogClosed)},e.prototype._onSpinBtnClick=function(t){t.data.instance.spinWheel()},e.prototype._onCheckAnswersBtnClick=function(t){t.data.instance._checkAnswer()},e.prototype._onSpinWheelEnd=function(){var e=this.winWheelInstance.getIndicatedSegment();this.element.trigger(t.WheelOfFortuneEvents.onWheelSpinEnd),this._chooseCategory(e.categoryId)},e.prototype._resetSpinWheel=function(){this.winWheelInstance.rotationAngle=0,this.winWheelInstance.draw()},e.prototype._onQuestionDialogClosed=function(t){t.data.instance._onRoundEnd()},e.prototype._resetQuestionDialog=function(){this.$checkAnswer.prop("disabled",!1),this.$dialog.removeClass(this.options.classes.answerCorrect+" "+this.options.classes.answerIncorrect)},e.prototype._getSelectedAnswerId=function(){return this.$dialog.find(":checked").attr("value")},e.prototype._checkAnswer=function(){var e=this;if(void 0!=this._getSelectedAnswerId()){this.$checkAnswer.prop("disabled",!0),this._disableAnswers(this.runtime.$currentAnswers);var i=this._getSelectedAnswerId(),s=this.runtime.currentQuestion.answers.find(function(t){return t.id==i}),n=this.runtime.game.rounds.slice(-1)[0];n.answerId=s.id,n.success=s.isCorrect,s.isCorrect?(this.$dialog.addClass(this.options.classes.answerCorrect),this.runtime.game.score+=this.options.pointsForSuccess):(this.$dialog.addClass(this.options.classes.answerIncorrect),this.runtime.game.lives>0&&this.runtime.game.lives--,this.runtime.game.score-=this.options.pointsForFail),this.element.trigger(t.WheelOfFortuneEvents.onAnswer,n),setTimeout(function(){e.$dialog.dialog("close")},this.options.autoCloseQuestionDialogIn)}},e.prototype._setCategoryToDialog=function(t){this.$dialog.data("uiDialog").uiDialog.attr("data-wof-category",t.id)},e.prototype._setTitleToDialog=function(t,e){this.$dialog.dialog("option","title",t.title)},e.prototype._setQuestionToDialog=function(t){this.$dialogQuestion.text(t.content)},e.prototype._createAnswers=function(t,e){for(var i='<ul class="'+this.options.classes.answers+'">',s=this.options.classes.answer,n=0,o=e;n<o.length;n++){var a=o[n];i+='<li><label class="'+s+'">\n                        <input type="radio" name="'+t.id+'" value="'+a.id+'">\n                        <span>'+a.content+"</span>\n                     </label></li>"}return i+="</ul>",$(i)},e.prototype._disableAnswers=function(t){t.find("input").attr("disabled","disabled")},e.prototype._openQuestionDialog=function(){this.answering=!0,this._resetQuestionDialog();var e=this.runtime.currentCategory,i=this.runtime.currentQuestion;this._setCategoryToDialog(e),this._setTitleToDialog(e,i),this._setQuestionToDialog(i);var s=this._createAnswers(i,i.answers);this.runtime.$currentAnswers=s,this.$dialogAnswers.empty().append(s),this.$dialog.dialog("open"),this.element.trigger(t.WheelOfFortuneEvents.onQuestion,this.runtime.game.rounds.slice(-1)[0])},e.prototype._removeCategoryFromWheel=function(t){var e=this.winWheelInstance.segments.find(function(e){e&&(e.categoryId,t.id)});-1!=e&&(this.winWheelInstance.deleteSegment(e),this.winWheelInstance.draw())},e.prototype._chooseCategory=function(t){var e=this.runtime.catalog,i=e.find(function(e){return e.id==t});this.runtime.currentCategory=i;var s=Math.floor(Math.random()*i.questions.length),n=i.questions[s];this.runtime.currentQuestion=n,i.questions.splice(s,1),0==i.questions.length&&(e.splice(e.indexOf(i),1),this._removeCategoryFromWheel(i)),this.runtime.game.currentRound++,this.runtime.game.rounds.push({categoryId:i.id,questionId:n.id,answerId:null,success:null}),this._openQuestionDialog()},e.prototype._updateLives=function(){if(-1!=this.options.lives&&this.$lives.length>0){var t=this.options.classes.lostLive,e=this.$lives.children().not("."+t),i=e.length;if(this.runtime.game.lives!=i)for(var s=i-this.runtime.game.lives,n=-1;s>0;n--,s--)e.eq(n).addClass(t)}},e.prototype._addResultToHistoric=function(t,e){if(void 0!=e){var i=this.runtime.historic[t];i&&i.$registryContainer.append('<i class="'+this.options.classes.historicItem+" "+(e?this.options.classes.historicItemSuccess:this.options.classes.historicItemFail)+'"></i>')}},e.prototype._redrawHistoric=function(){this.runtime.historic=this._createHistoric();for(var t=0,e=this.runtime.game.rounds;t<e.length;t++){var i=e[t];this._addResultToHistoric(i.categoryId,i.success)}},e.prototype._updatePoints=function(){this.$score.html(this.runtime.game.score),this.$objectivesBar.length>0&&this.$objectivesBar.progressbar("option","value",100*this.runtime.game.score/this.runtime.maxScore)},e.prototype._onRoundEnd=function(){this._updateLives(),this._updatePoints();var t=this.runtime.game.rounds.slice(-1)[0];this._addResultToHistoric(t.categoryId,t.success),this.runtime.$currentAnswers=null,this.runtime.currentCategory=null,this.runtime.currentQuestion=null,this.answering=!1,this._nextRound()},e.prototype._restoreSavedGame=function(){},e.prototype._calcMaxRounds=function(t){var e=this.options.rounds;return-1==e&&(e=t.numCategories*t.numQuestions),e},e.prototype._calcMaxScore=function(t){return t.maxRounds*this.options.pointsForSuccess},e.prototype._getAvailableCatalog=function(t){var e,i=this.options.catalog,s=i.length,n=0;if(t){var o=t.rounds;e=$.extend(!0,[],i);for(var a=function(t,i){var s=o[t],n=e.find(function(t){return t.id==s.categoryId});if(n){var a=n.questions.find(function(t){return t.id==s.questionId});if(a){var r=n.questions.indexOf(a);n.questions.splice(r,1),0==n.questions.length&&e.splice(e.indexOf(n),1)}}},r=0,h=o.length;r<h;r++)a(r)}else{for(var l=0,c=i.length;l<c;l++){n+=i[l].questions.length}e=$.extend(!0,[],i)}return{numOfCategories:s,numOfQuestions:n,catalog:e}},e.prototype._nextRound=function(){-1!=this.options.lives&&0==this.runtime.game.lives?(this.element.removeClass(this.options.classes.running),this.element.addClass(this.options.classes.fail),this.element.trigger(t.WheelOfFortuneEvents.onEnd,{success:!1,game:this.runtime.game,maxScore:this.runtime.maxScore})):-1!=this.options.rounds&&this.runtime.game.currentRound==this.options.rounds?(this.element.removeClass(this.options.classes.running),this.runtime.game.score>=this.options.cutOfMarkPoints?(this.element.addClass(this.options.classes.success),this.element.trigger(t.WheelOfFortuneEvents.onEnd,{success:!0,game:this.runtime.game,maxScore:this.runtime.maxScore})):(this.element.addClass(this.options.classes.fail),this.element.trigger(t.WheelOfFortuneEvents.onEnd,{success:!1,game:this.runtime.game,maxScore:this.runtime.maxScore}))):(this._resetSpinWheel(),this.spinDisabled=!1,this.$spin.prop("disabled",!1))},e.prototype.spinWheel=function(){1!=this.disabled&&1!=this.answering&&1!=this.spinDisabled&&(this.spinDisabled=!0,this.$spin.prop("disabled",!0),this.winWheelInstance.startAnimation(),this.element.trigger(t.WheelOfFortuneEvents.onWheelSpin))},e.prototype.newGame=function(t){this.element.addClass(this.options.classes.running);var e=this._getAvailableCatalog(t),i=e.numOfQuestions,s=e.numOfCategories,n=e.catalog;this.runtime={numOfQuestions:i,numOfCategories:s,catalog:n,game:t||{currentRound:0,lives:this.options.lives,score:0,rounds:[]}},this.runtime.maxRounds=this._calcMaxRounds(this.runtime),this.runtime.maxScore=this._calcMaxScore(this.runtime),this._createLives(),this._redrawHistoric(),this._resetWheel(),this._updateLives(),this._updatePoints(),this._nextRound()},e.prototype.enable=function(){},e.prototype.disable=function(){},e.prototype.refresh=function(){},e}();if(Object.hasOwnProperty("getOwnPropertyDescriptors")){for(var A={},S=Object.getOwnPropertyNames(w.prototype),_=0,R=S.length;_<R;_++){var b=S[_];A[b]=Object.getOwnPropertyDescriptor(w.prototype,b).value}$.widget("ui.jqWheelOfFortune",A)}else $.widget("ui.jqWheelOfFortune",w.prototype);t.WheelOfFortuneQuestionAnswer=s,t.WheelOfFortuneQuestion=n,t.WheelOfFortuneRound=o,t.WheelOfFortuneRuntimeGame=a,t.WheelOfFortuneRuntime=r,t.WheelOfFortuneGame=w,Object.defineProperty(t,"__esModule",{value:!0})});
